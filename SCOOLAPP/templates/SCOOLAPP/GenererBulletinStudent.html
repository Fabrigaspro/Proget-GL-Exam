{% extends "SCOOLAPP/baseAdmin.html" %}
{% load static %}

{% block header %}
    <title>SCOOLAPP - Students - Bulletin </title>

    <link rel="stylesheet" href="{% static 'SCOOLAPP/vendor/toastr/css/toastr.min.css' %}">
{% endblock %}

{% block content %}
    <!-- row -->
    <div class="container-fluid">
                        
        <div class="row page-titles mx-0">
            <div class="col-sm-6 p-md-0">
                <div class="welcome-text">
                    <h4>About Bulletin Student</h4>
                </div>
            </div>
            <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{%url 'acceuilAdmin' %}">Home</a></li>
                    <li class="breadcrumb-item active"><a href="javascript:void(0);">Students</a></li>
                    <li class="breadcrumb-item active"><a href="javascript:void(0);">Bulletin</a></li>
                </ol>
            </div>
        </div>
        
        <div class="row">
            <div class="col-xl-3 col-xxl-4 col-lg-4">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="text-center p-3 overlay-box" style="background-image: url(/static/SCOOLAPP/images/big/img8.jpg);">
                                <div class="profile-photo">
                                    <img src="{{elev.photoElev.url}}" width="100" class="img-fluid rounded-circle" alt="">
                                </div>
                                <h3 class="mt-3 mb-1 text-white">{{elev.nomElev}} {{elev.prenomElev}}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Infos sur bulletin</h2>
                            </div>
                            <div class="card-body pb-0">
                                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex px-0 justify-content-between">
                                        <strong>Genre</strong>
                                        <span class="mb-0">{{elev.genreElev}}</span>
                                    </li>
                                    <li class="list-group-item d-flex px-0 justify-content-between">
                                        <strong>Classe</strong>
                                        <span class="mb-0">{{elev.ClassElev}}</span>
                                    </li>
                                    <li class="list-group-item d-flex px-0 justify-content-between">
                                        <strong>Phone</strong>
                                        <span class="mb-0">{{elev.TelephoneElev}}</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-footer pt-0 pb-0 text-center">
                                <div class="row">
                                    <div class="col-4 pt-2 pb-2 border-right">
                                        <h3 class="mb-1 text-primary">{{Bulletin.Set_MoyGE}}</h3>
                                        <span>Moyenne</span>
                                    </div>
                                    <div class="col-4 pt-2 pb-2 border-right">
                                        <h3 class="mb-1 text-primary">14</h3>
                                        <span>Rang</span>
                                    </div>
                                    <div class="col-4 pt-2 pb-2 border-right">
                                        <h3 class="mb-1 text-primary">{{Bulletin.MoyGeneraleC}}</h3>
                                        <span>Moyenne Gererale</span>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <h5> Son pourcentage de reuissite
                                <span class="pull-right" id="progressbarVal">{{Bulletin.pourcReuiss}}%</span>
                            </h5>
                            <div class="progress" id="progressbar">
                                {% if Bulletin.pourcReuiss >= 50 %}
                                    <div class="progress-bar bg-success progress-animated" style="width: {{Bulletin.pourcReuiss}}%; height:6px;" role="progressbar">
                                {% else %}
                                    <div class="progress-bar bg-danger progress-animated" style="width: {{Bulletin.pourcReuiss}}%; height:6px;" role="progressbar">
                                {% endif %}
                                   <span class="sr-only">{{Bulletin.pourcReuiss}}</span>
                                </div>
                            </div>
                            <br><br>
                            <h5> pourcentage de reuissite de la classe
                                <span class="pull-right" id="progressbarVal">{{Bulletin.pourcReuissC}}%</span>
                            </h5>
                            <div class="progress" id="progressbar">
                                {% if Bulletin.pourcReuissC >= 50 %}
                                    <div class="progress-bar bg-success progress-animated" style="width: {{Bulletin.pourcReuissC}}%; height:6px;" role="progressbar">
                                {% else %}
                                    <div class="progress-bar bg-danger progress-animated" style="width: {{Bulletin.pourcReuissC}}%; height:6px;" role="progressbar">
                                {% endif %}
                                   <span class="sr-only">{{Bulletin.pourcReuissC}}</span>
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header d-block">
                                <h4 class="card-title">Address </h4>
                            </div>
                            <div class="card-body">
                                <p class="mb-0">8901 Marmora Road Chi Minh City, Vietnam</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-9 col-xxl-8 col-lg-8">
                <div class="card">
                    <div class="card-body">
                        <div class="profile-tab">
                            <div class="custom-tab-1">
                                <ul class="nav nav-tabs">
                                    <li class="nav-item"><a href="#detail-bulletin" data-toggle="tab" class="nav-link active show">Details sur bulletin</a></li>
                                    <li class="nav-item"><a href="#Print-Bulletin" data-toggle="tab" class="nav-link ">Enregistrer bulletin</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div id="detail-bulletin" class="tab-pane fade active show">
                                        <br>
                                        <h4 class="text-primary">Information à inscrire sur le bulletin de notes</h4>
                                        <br>
                                        <div class="table-responsive">
                                            <table id="example" class="table header-border table-responsive-sm" style="min-width: 845px">
                                                <thead>
                                                    <tr>
                                                        <th style="padding-bottom: 50px;">Matières</th>
                                                        <th style="padding-bottom: 50px;">Coef</th>
                                                        <th>
                                                            <div class="table">
                                                                <table id="example" class="table header-border table-sm" style="width: 10px">
                                                                    <thead>
                                                                        <tr><th>Elève</th></tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr><td>Moy.</td></tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </th>
                                                        <th>
                                                            <div class="table">
                                                                <table id="example" class="table header-border table-sm" style="width: 80px">
                                                                    <tr>Classe</tr>
                                                                    <tr>
                                                                        <td style="width:10px">Min.</td>
                                                                        <td>Max.</td>
                                                                        <td>Moy.</td>
                                                                        <td>Rang.</td>
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                        </th>
                                                        <th style="padding-bottom: 50px;">Appréciation du travail</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for datMat in Bulletin.DatasbyGroup %}
                                                        {% for dico in datMat.dico %}
                                                            <tr>
                                                                <td><strong>{{dico.nomMat}}</strong></td>								
                                                                <td>{{dico.Coeff}}</td>
                                                                <td>{{dico.noteE}}</td>

                                                                <td>
                                                                    <table id="" class="table table-responsive" style="max-width: 500px;">
                                                                            <tr>
                                                                                <td style="padding: 0 10px;">{{dico.min}}</td>
                                                                                <td style="padding: 0 10px;">{{dico.max}}</td>
                                                                                <td style="padding: 0 10px;">{{dico.moyM}}</td>
                                                                                <td style="padding: 0 10px;">Rang</td>
                                                                            </tr>
                                                                    </table>
                                                                </td>

                                                                <td>{{dico.comment}}</td>								
                                                            </tr>
                                                        {% endfor %}
                                                        <tr>
                                                            <td><strong>{{datMat.datGen.nom}}</strong></td>								
                                                            <td><strong>{{datMat.datGen.TotcoefG}}</strong></td>								
                                                            <td><strong>{{datMat.datGen.moyE}}</strong></td>	
                                                            <td style="padding-top: 30px;">
                                                                <table id="" class="table table-responsive" style="max-width: 500px;">
                                                                        <tr>
                                                                            <td style="padding: 0 10px;"><strong>XX</strong></td>								
                                                                            <td style="padding: 0 10px;"><strong>XX </strong></td>		
                                                                            <td style="padding: 0 10px;"><strong>{{datMat.datGen.moyC}}</strong></td>										
                                                                            <td style="padding: 0 10px;"><strong>Rang</strong></td>
                                                                        </tr>
                                                                </table>
                                                            </td>														
                                                            <td><strong>A completer sur word</strong></td>								
                                                        </tr>
                                                    {% endfor %}
                                                    
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div id="Print-Bulletin" class="tab-pane fade ">
                                        <br>
                                        <h4 class="text-primary">Choix du fichier word model</h4>
                                        <p>Si vous n'avez pas encore téléchargé le modele word du relevé de notes pour cette classe, veillez le faire. Dans le cas où vous l'avez déjà, en choisissant un nouveaux fichier word vous remplacerez l'ancien modele.</p>
                                        
                                        <form class="formul" id="post_Edit" method="post" action="{% url 'EditModWordClass' elev.ClassElev.id %}"
                                            enctype="multipart/form-data"> {% csrf_token %}
                                            <li class="list-group-item d-flex px-0 justify-content-between">
                                                <div class="col-lg-6 col-md-6 col-sm-12">
                                                    <div class="form-group">
                                                        <input type="file" accept=".docx" id="Moddocx" name="Moddocx" class="form-control" value="{{Clas.codeClass}}">
                                                    </div>
                                                </div>
                                                <button type="button" onclick="ChangeModelClass()" class="btn btn-secondary" style="height: 80%;">Edditer</button>
                                            </li>
                                        </form>
                                        <br><br>
                                        <h4 class="text-primary">Telechargement du fichier word</h4>
                                        <p>Le fichier word du relevé de notes de cet etudiant sera telechargé dans le fichier Telechargement de votre machine.</p>
                                        <br><br>
                                        <button type="button" onclick="GenererWordE('{{elev.id}}', '{{Bulletin.ficheWordE.url}}')" class="btn btn-warning">télécharger</button>
                                        <div id="idclass" style="display: none;">{{elev.ClassElev.id}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <script type="text/javascript">
        let idModWord= document.getElementById("Moddocx");
        let idClass= document.getElementById("idclass");

        function ControlSelection(){
            console.log("ttttttttttttttt !!!")
            if(idModWord.value != ""){ChangeModelClass();}
        }

        function ChangeModelClass(){
            if(idModWord.value != ""){
                var data = new FormData()
                console.log(data)
                data.append("Moddocx", $("input[id^='Moddocx']")[0].files[0])
                console.log(data)
                data.append("csrfmiddlewaretoken", "{{ csrf_token }}")

                $.ajax({
                    type: "POST",
                    url: "/api/EditModWordClass/"+ String(idClass.innerHTML),
                    data:data,
                    processData:false,
                    contentType:false,
                    mimeType: "multipart/form-data",
                    success:function(){
                        console.log("GOOOOOODDDDDDDDDDDDDDD !!!")
                        infosg();
                    }
                })
            }
            else{
                ErrorMsg();
            }
        }

        function GenererWordE(idE,UrlBul){
            console.log(UrlBul)
            $.ajax({
                type: "GET",
                url: "/api/CreateWordElev/"+ String(idE),
                success:function(){
                    console.log("GOOOOOODDDDDDDDDDDDDDD !!!")
                    infosgTelech();
			        window.location.href= UrlBul

                }
            })
        }

        function infosg() {
            toastr.success("Modification effectuée correctement", "Succès", {
                timeOut: 3e3,
                closeButton: !0,
                debug: !1,
                newestOnTop: !0,
                progressBar: !0,
                preventDuplicates: !0,
                onclick: null,
                showDuration: "300",
                hideDuration: "1000",
                extendedTimeOut: "1000",
                showEasing: "swing",
                hideEasing: "linear",
                showMethod: "fadeIn",
                hideMethod: "fadeOut",
                tapToDismiss: !1
            })
        }
        function infosgTelech() {
            toastr.success("Bulletin genéré correctement", "Succès", {
                timeOut: 3e3,
                closeButton: !0,
                debug: !1,
                newestOnTop: !0,
                progressBar: !0,
                preventDuplicates: !0,
                onclick: null,
                showDuration: "300",
                hideDuration: "1000",
                extendedTimeOut: "1000",
                showEasing: "swing",
                hideEasing: "linear",
                showMethod: "fadeIn",
                hideMethod: "fadeOut",
                tapToDismiss: !1
            })
        }
        function ErrorMsg() {
            toastr.error("Le champ est vide", "Erreur", {
                positionClass: "toast-top-right",
                timeOut: 1e3,
                closeButton: !0,
                debug: !1,
                newestOnTop: !0,
                progressBar: !0,
                preventDuplicates: !0,
                onclick: null,
                showDuration: "300",
                hideDuration: "1000",
                extendedTimeOut: "1000",
                showEasing: "swing",
                hideEasing: "linear",
                showMethod: "fadeIn",
                hideMethod: "fadeOut",
                tapToDismiss: !1
            })
        }

    </script>
{% endblock %}


{% block scripts %}
    <!-- Toastr -->
    <script src="{% static 'SCOOLAPP/vendor/toastr/js/toastr.min.js' %}"></script>

    <!-- All init script -->
    <script src="{% static 'SCOOLAPP/js/plugins-init/toastr-init.js' %}"></script>
    <!-- Svganimation scripts -->
    <script src="{% static 'SCOOLAPP/vendor/svganimation/vivus.min.js' %}"></script>
    <script src="{% static 'SCOOLAPP/vendor/svganimation/svg.animation.js' %}"></script>
    <script src="{% static 'SCOOLAPP/js/styleSwitcher.js' %}"></script>
    
{% endblock %}