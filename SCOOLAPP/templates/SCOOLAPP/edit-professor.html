{% extends "SCOOLAPP/baseAdmin.html" %}
{% load static %}


{% block header %}
    <title>SCOOLAPP - Students - Edit Professor </title>
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'SCOOLAPP/images/favicon.png' %}">
    <link rel="stylesheet" href="{% static 'SCOOLAPP/vendor/bootstrap-select/dist/css/bootstrap-select.min.css' %}">
	
	<!-- Pick date -->
    <link rel="stylesheet" href="{% static 'SCOOLAPP/vendor/pickadate/themes/default.css' %}">
    <link rel="stylesheet" href="{% static 'SCOOLAPP/vendor/pickadate/themes/default.date.css' %}">
{% endblock %}

{% block content %}
    <!-- row -->
    <div class="container-fluid">
                        
        <div class="row page-titles mx-0">
            <div class="col-sm-6 p-md-0">
                <div class="welcome-text">
                    <h4>Edit Professor</h4>
                </div>
            </div>
            <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{%url 'acceuilAdmin' %}">Acceuil</a></li>
                    <li class="breadcrumb-item active"><a href="{%url 'SearchProfsToModif'%}">Professors</a></li>
                    <li class="breadcrumb-item active"><a href="javascript:void(0)">Edit Professor</a></li>
                </ol>
            </div>
        </div>
        
        <div class="row">
            <div class="col-xl-12 col-xxl-12 col-sm-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Informations de base</h5>
                    </div>
                    <div id="mgsError" class="card-header" style="display: none;">
                    </div>
                    <div class="card-body">
                        <form class="formul" method="post" action="{% url 'AddModifsProf' prof.id %}" id="formul"
                        enctype="multipart/form-data" > {% csrf_token %}
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Nom</label>
                                        <input type="text" id="Nom" name="Nom" class="form-control" value="{{prof.nomProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Prenom</label>
                                        <input type="text" id="Prenom" name="Prenom" class="form-control" value="{{prof.prenomProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" id="Email" name="Email" class="form-control" value="{{prof.EmailProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Date d'arrivée</label>
                                        <input id="DateArriv" name="DateArriv" class="datepicker-default form-control" id="datepicker" value="{{prof.DateJoinProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">mot de passe</label>
                                        <input type="password" id="Password" name="Password" class="form-control" value="{{prof.password}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Confirer le mot de passe</label>
                                        <input type="password" id="PasswordConf" name="PasswordConf" class="form-control" value="{{prof.password}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Matricule</label>
                                        <input type="text" id="Matricule" name="Matricule" class="form-control" value="{{prof.MatriculeProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group"  >
                                        <label class="form-label">Genre</label>
                                        <div id="contourSelect">
                                            <Select class="form-control" id="Genre" name="Genre">
                                                <option class="traitpoint" value="Class" disabled>----------------</option>
                                                {% if prof.genreProf == "Masculin" %}
                                                    <option value="Male" selected>Masculin</option>
                                                    <option value="Female">Feminin</option>
                                                    {% else %}
                                                    <option value="Male">Masculin</option>
                                                    <option value="Female" selected>Feminin</option>
                                                {% endif %}
                                            </Select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12" style="display: none;">
                                    <input type="text" name="OldUsername" class="form-control" value="{{prof.MatriculeProf}}">
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Adresse</label>
                                        <input type="text" id="Adresse" name="Adresse" class="form-control" value="{{prof.AdresseProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Numero de telephome</label>
                                        <input type="text" id="Telephone" name="Telephone" class="form-control" value="{{prof.TelephoneProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Designation</label>
                                        <input type="text" id="Designation" name="Designation" class="form-control" value="{{prof.DesignationProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Date de naissance</label>
                                        <input name="Datnaiss" id="Datnaiss" class="datepicker-default form-control" value="{{prof.dateNaisProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Matieres de competances</label>
                                        <input type="text" name="MatDomaine" id="MatDomaine" class="form-control" value="{{prof.MatpossibProf}}">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" name="Descrpt" id="Descrpt" rows="5">{{prof.DescrptProf}}</textarea>
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="form-group fallback w-100">
                                        <label class="form-label">Photo</label>
                                        <input type="file" name="Photo" id="Photo" class="dropify" data-default-file="">
                                    </div>
                                </div>
                                <br><br>
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <button type="button" onclick="ConfirmModification('{{prof.id}}')" class="btn btn-primary">Submit</button>
                                    <a href="{% url 'ViewsEleves' %}"><button type="button" class="btn btn-dark">Cancel</button></a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        let CS = document.getElementById("contourSelect");
        let mgsError = document.getElementById("mgsError");
        var isconfirm = false, verifmat = true;

        let idnom = document.getElementById("Nom");
        let idprenom = document.getElementById("Prenom");
        let idEmail = document.getElementById("Email");
        let idDatArriv = document.getElementById("DateArriv");
        let idPw = document.getElementById("Password");
        let idPwc = document.getElementById("PasswordConf");
        let idmat = document.getElementById("Matricule");
        let idGenre = document.getElementById("Genre");
        let idAdrss = document.getElementById("Adresse");
        let idtel = document.getElementById("Telephone");
        let idDesign = document.getElementById("Designation");
        let idDatnaiss = document.getElementById("Datnaiss");
        let idMatDom = document.getElementById("MatDomaine");
        var iddescpC = document.querySelector('textarea');
        let idimage = document.getElementById("Photo");

        function ControlSaisie(){
            if (isconfirm){
                console.log(idimage.value,"-----",idimage.value == "","---",)
                if(idnom.value.toLowerCase() == idnom.value.toUpperCase()){idnom.style.borderColor = "red";idnom.placeholder = "Champ obligatoire !";}else{idnom.style.borderColor = "green";}
                if(idprenom.value.toLowerCase() == idprenom.value.toUpperCase()){idprenom.style.borderColor = "red";idprenom.placeholder = "Champ obligatoire !";}else{idprenom.style.borderColor = "green";}
                if(idEmail.value.toString().toLowerCase() == idEmail.value.toString().toUpperCase()){idEmail.style.borderColor = "red";idEmail.placeholder = "Champ obligatoire !";}else{idEmail.style.borderColor = "green";}
                if((idPw.value.toLowerCase() == idPw.value.toUpperCase()) && idPw.value ==""){idPw.style.borderColor = "red";idPw.placeholder = "Champ obligatoire !";}else{idPw.style.borderColor = "green";}
                if((idPwc.value.toLowerCase() == idPwc.value.toUpperCase()) && idPwc.value ==""){idPwc.style.borderColor = "red";idPwc.placeholder = "Champ obligatoire !";}else{idPwc.style.borderColor = "green";}
                if(idmat.value.toLowerCase() == idmat.value.toUpperCase()){idmat.style.borderColor = "red";idmat.placeholder = "Champ obligatoire !";}else{idmat.style.borderColor = "green";}
                if(idAdrss.value.toLowerCase() == idAdrss.value.toUpperCase()){idAdrss.style.borderColor = "red";idAdrss.placeholder = "Champ obligatoire !";}else{idAdrss.style.borderColor = "green";}
                if((idtel.value.toLowerCase() == idtel.value.toUpperCase()) && idtel.value ==""){idtel.style.borderColor = "red";idtel.placeholder = "Champ obligatoire !";}else{idtel.style.borderColor = "green";}
                if(idDesign.value.toLowerCase() == idDesign.value.toUpperCase()){idDesign.style.borderColor = "red";idDesign.placeholder = "Champ obligatoire !";}else{idDesign.style.borderColor = "green";}
                if(idMatDom.value.toLowerCase() == idMatDom.value.toUpperCase()){idMatDom.style.borderColor = "red";idMatDom.placeholder = "Champ obligatoire !";}else{idMatDom.style.borderColor = "green";}
                if(iddescpC.value.toLowerCase() == iddescpC.value.toUpperCase()){iddescpC.style.borderColor = "red";iddescpC.placeholder = "Champ obligatoire !";}else{iddescpC.style.borderColor = "green";}
                if(idGenre.value == ""){CS.style.border = "1px solid red";}else{CS.style.border = "1px solid green";}
                if(idDatArriv.value == ""){idDatArriv.style.borderColor = "red";idDatArriv.placeholder = "Champ obligatoire !";}else{idDatArriv.style.borderColor = "green";}
                if(idDatnaiss.value == ""){idDatnaiss.style.borderColor = "red";idDatnaiss.placeholder = "Champ obligatoire !";}else{idDatnaiss.style.borderColor = "green";}  
            }
        }
    
    // evenements
        let main = document.getElementById("bodyy");
        main.addEventListener("click", () => {
            ControlSaisie();
        })
        main.addEventListener("keyup", () => {
            ControlSaisie();
        })
        main.addEventListener("mousemove", () => {
            ControlSaisie();
        })

    
        function ConfirmModification(idP) {
            isconfirm = true;
            if(idnom.value!="" & idprenom.value!="" & idEmail.value!="" & idDatArriv.value!="" & idPw.value!="" & idPwc.value!="" & idmat.value!="" & idGenre.value!="" & idAdrss.value!="" & idtel.value!="" & idDesign.value!="" & idDatnaiss.value!="" & idMatDom.value!="" & iddescpC.value!=""){
                if(idPw.value == idPwc.value){
                    $.ajax({
                        type: 'GET',
                        url: "/api/Professeur/GetdatasProfsbyidp/"+String(idP),
                        success: function(response){
                            var verif = true;
                            for(key in response.Profs){
                                console.log(response.Profs[key].MatriculeProf,"---",idmat.value)
                                if(response.Profs[key].MatriculeProf == idmat.value){verif = false;}
                            }
                            if( verif ){ 
                                console.log("iciiiiooo");
                                verifmat = true;
                                idmat.style.borderColor = "green";
                                mgsError.style.display = "none";
                                let confirmation = document.getElementById("confirmation1");
                                confirmation.style.display = "block"
                                let main = document.getElementById("main");
                                main.style.filter = "blur(4px)"
                                return true
                            }
                            else{
                                verifmat = false;
                                idmat.style.borderColor = "red";
                                idmat.placeholder = "Champ obligatoire et unique !"
                                mgsError.style.display = "block";
                                mgsError.style.color = "red";
                                $('#mgsError').empty();
                                $('#mgsError').append(" Le Matricule doit etre unique !!! Veillez le modifier");
                            }
                        }
                    })
                }
                else{
                    idPw.style.borderColor = "red";
                    idPwc.style.borderColor = "red";
                    mgsError.style.display = "block";
                    mgsError.style.color = "red";
                    $('#mgsError').empty();
			        $('#mgsError').append(" Le not de passe doit être identique.");
                }
            }
            else{
                mgsError.style.display = "block";
                mgsError.style.color = "red"; 
                $('#mgsError').empty();
			    $('#mgsError').append("Veillez s'il vous plait remplir correctement tous les champs vides.");
                return false 
            }
            
        }
    </script>
   
{% endblock %}

{% block scripts %}
	<!-- Datatable -->
    <script src="{% static 'SCOOLAPP/vendor/datatables/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'SCOOLAPP/js/plugins-init/datatables.init.js' %}"></script>
	
    <!-- Svganimation scripts -->
    <script src="{% static 'SCOOLAPP/vendor/svganimation/vivus.min.js' %}"></script>
    <script src="{% static 'SCOOLAPP/vendor/svganimation/svg.animation.js' %}"></script>
    <script src="{% static 'SCOOLAPP/js/styleSwitcher.js' %}"></script>
	
	<!-- pickdate -->
    <script src="{% static 'SCOOLAPP/vendor/pickadate/picker.js' %}"></script>
    <script src="{% static 'SCOOLAPP/vendor/pickadate/picker.time.js' %}"></script>
    <script src="{% static 'SCOOLAPP/vendor/pickadate/picker.date.js' %}"></script>
	
	<!-- Pickdate -->
    <script src="{% static 'SCOOLAPP/js/plugins-init/pickadate-init.js' %}"></script>

{% endblock %}

{% block content2 %}  
    <div id="confirmation1" class="confirm confirm2">
        <div class="uu">
            <div class="confirm-main2">
                <header class="confirm-header">
                    <div id="out" style="margin-left: 85%;width: 10%;margin-bottom: 10px;"><a href="#">x</a></div>
                </header>
                <section class="confirm-section">
                    Confirmez-vous les modifications apportés sur ce professeur ?
                </section>
                <footer class="confirm-footer">
                    <button class="bout annnulCC" id="annnulCC" > Annuler</button>
                    <button class="bout confirmCC" id="confirmCC"> Confirmer</button>
                </footer>
            </div>
        </div>
    </div>
    <script>
        function onSend(){
            var formul = document.getElementById("formul");
            formul.submit();
            console.log("action done !!!")
        }
        function oncancel(){
            confirmation.style.display = "none";
            console.log("annull !!!");
        }
        let boutConf = document.getElementById("confirmCC");
        let confirmation = document.getElementById("confirmation1");
        let boutAnnul = document.getElementById("annnulCC");
        let outCroix = document.getElementById("out");
        boutConf.addEventListener("click", () => {
            onSend();
        })
        outCroix.addEventListener("click", () => {
            oncancel();
        })
        boutAnnul.addEventListener("click", () => {
            oncancel();
        })
        confirmation.addEventListener("click", () => {
            oncancel();
        })
        document
            .querySelector(".confirm-main2")
            .addEventListener("click", (e) => e.stopPropagation());
    </script>
{% endblock %}




